version: '3.9'
services:
  sync:
    image: wazoplatform/wait
    depends_on:
      agid:
        condition: service_healthy
    environment:
      TIMEOUT: "${INTEGRATION_TEST_TIMEOUT}"

  agid:
    image: wazoplatform/wazo-agid-tests
    ports:
      - "4573"
    environment:
      - PYTHONUNBUFFERED=TRUE
    depends_on:
      postgres:
        condition: service_healthy
    volumes:
      - "../..:/usr/src/wazo-agid"
      - "./etc/wazo-agid/conf.d/50-default.yml:/etc/wazo-agid/conf.d/50-default.yml"
      # - "${LOCAL_GIT_REPOS}/xivo-dao/xivo_dao:/opt/venv/lib/python2.7/site-packages/xivo_dao"
      # - "${LOCAL_GIT_REPOS}/xivo-lib-python/xivo:/opt/venv/lib/python2.7/site-packages/xivo"

  auth:
    image: wazoplatform/wazo-auth-mock
    ports:
      - '9497'
    healthcheck:
      test: ["CMD-SHELL", "echo", "/dev/tcp/localhost/9497"]
      interval: 1s
      retries: 30

  postgres:
    image: wazoplatform/wazo-confd-db-test:local
    ports:
      - "5432"
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready"]
      interval: 5s
      timeout: 30s
      retries: 5
